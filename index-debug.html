<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dYdX API Debug</title>
    <style>
        body {
            font-family: monospace;
            background: #0a0a0a;
            color: #0f0;
            padding: 20px;
        }
        .endpoint {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #333;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .pending { color: #ff0; }
        pre { 
            background: #111; 
            padding: 10px; 
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>dYdX API Endpoint Debug</h1>
    <div>
        <input type="text" id="address" value="dydx1agxtmjdgw7nrgs7m086m3qse7hwyf54gfeampv" style="width: 500px; padding: 5px;">
        <button onclick="testAll()">Test All Endpoints</button>
    </div>
    <div id="results"></div>

    <script>
        const BASE_URL = 'https://indexer.dydx.trade/v4';
        
        async function testEndpoint(name, url) {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'endpoint';
            resultDiv.innerHTML = `<h3>${name}</h3><div>URL: ${url}</div><div class="pending">Testing...</div>`;
            document.getElementById('results').appendChild(resultDiv);
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML += `<div class="success">✓ Status: ${response.status}</div>`;
                    resultDiv.innerHTML += `<pre>${JSON.stringify(data, null, 2).substring(0, 500)}...</pre>`;
                } else {
                    resultDiv.innerHTML += `<div class="error">✗ Status: ${response.status}</div>`;
                    resultDiv.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (error) {
                resultDiv.innerHTML += `<div class="error">✗ Error: ${error.message}</div>`;
            }
        }
        
        async function testAll() {
            const address = document.getElementById('address').value;
            document.getElementById('results').innerHTML = '';
            
            // Test different endpoint variations
            const endpoints = [
                // Variation 1: subaccountNumber (as in working version)
                ['Subaccount (subaccountNumber/0)', `${BASE_URL}/addresses/${address}/subaccountNumber/0`],
                
                // Variation 2: subaccount (as in new docs)
                ['Subaccount (subaccount/0)', `${BASE_URL}/addresses/${address}/subaccount/0`],
                
                // Variation 3: List subaccounts first
                ['List Subaccounts', `${BASE_URL}/addresses/${address}/subaccounts`],
                
                // Test perpetual positions with different paths
                ['Positions (v1)', `${BASE_URL}/addresses/${address}/subaccountNumber/0/perpetualPositions`],
                ['Positions (v2)', `${BASE_URL}/addresses/${address}/subaccount/0/perpetualPositions`],
                ['Positions (v3)', `${BASE_URL}/perpetualPositions?address=${address}&subaccountNumber=0`],
                
                // Test fills
                ['Fills (v1)', `${BASE_URL}/addresses/${address}/subaccountNumber/0/fills`],
                ['Fills (v2)', `${BASE_URL}/addresses/${address}/subaccount/0/fills`],
                ['Fills (v3)', `${BASE_URL}/fills?address=${address}&subaccountNumber=0`],
                
                // Test orders
                ['Orders (v1)', `${BASE_URL}/addresses/${address}/subaccountNumber/0/orders`],
                ['Orders (v2)', `${BASE_URL}/addresses/${address}/subaccount/0/orders`],
                ['Orders (v3)', `${BASE_URL}/orders?address=${address}&subaccountNumber=0`],
                
                // Historical PnL
                ['Historical PnL (v1)', `${BASE_URL}/addresses/${address}/subaccountNumber/0/historicalPNLs`],
                ['Historical PnL (v2)', `${BASE_URL}/addresses/${address}/subaccount/0/historicalPNLs`],
                ['Historical PnL (v3)', `${BASE_URL}/historical-pnl?address=${address}&subaccountNumber=0`],
                
                // Test basic endpoints
                ['Time', `${BASE_URL}/time`],
                ['Height', `${BASE_URL}/height`],
                ['Markets', `${BASE_URL}/perpetualMarkets?limit=1`]
            ];
            
            for (const [name, url] of endpoints) {
                await testEndpoint(name, url);
                await new Promise(resolve => setTimeout(resolve, 100)); // Small delay between requests
            }
        }
        
        // Auto-run on load
        window.addEventListener('load', testAll);
    </script>
</body>
</html>