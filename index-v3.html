<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dYdX Analytics v3.0.0</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="breadcrumb">ANALYTICS / OVERVIEW</div>
            <div class="header-right">
                <span class="status-badge live">LIVE</span>
                <div class="address mono">Not Connected</div>
            </div>
        </div>

        <!-- Address Input Section -->
        <div style="background: var(--bg-secondary); padding: 20px; margin-bottom: 24px;">
            <div style="display: flex; gap: 16px; align-items: center;">
                <input type="text" 
                       id="addressInput" 
                       placeholder="Enter dYdX address (e.g., dydx1...)" 
                       style="flex: 1; background: var(--bg-elevated); border: 1px solid var(--border); 
                              color: var(--text-primary); padding: 12px; font-family: 'JetBrains Mono', monospace;">
                <button id="loadDashboard" 
                        style="padding: 12px 24px; background: var(--text-primary); color: var(--bg-primary);
                               border: none; cursor: pointer; font-weight: 600; text-transform: uppercase;">
                    Load Dashboard
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="overview">OVERVIEW</div>
            <div class="nav-tab" data-tab="performance">PERFORMANCE</div>
            <div class="nav-tab" data-tab="risk">RISK ANALYSIS</div>
            <div class="nav-tab" data-tab="positions">POSITIONS</div>
            <div class="nav-tab" data-tab="behavior">BEHAVIOR</div>
            <div class="nav-tab" data-tab="market">MARKET STRUCTURE</div>
        </div>

        <!-- Loading State -->
        <div id="loader" class="loading" style="display: none;">
            <div class="spinner"></div>
            <div style="margin-top: 16px;">Loading portfolio data...</div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message" style="display: none;"></div>

        <!-- Overview Tab -->
        <div class="tab-content active" id="overview">
            <!-- Primary Metrics -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Total P&L</div>
                    <div class="metric-value mono" id="totalPnL">-</div>
                    <div class="metric-change mono" id="totalPnLChange">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Win Rate</div>
                    <div class="metric-value mono" id="winRate">-</div>
                    <div class="metric-change mono" id="winRateDetail">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Profit Factor</div>
                    <div class="metric-value mono" id="profitFactor">-</div>
                    <div class="metric-change mono" id="profitFactorDetail">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Sharpe Ratio</div>
                    <div class="metric-value mono" id="sharpeRatio">-</div>
                    <div class="metric-change mono">30-day rolling</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Sortino Ratio</div>
                    <div class="metric-value mono" id="sortinoRatio">-</div>
                    <div class="metric-change mono">Downside focus</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Max Drawdown</div>
                    <div class="metric-value mono" id="maxDrawdown">-</div>
                    <div class="metric-change mono" id="maxDrawdownDate">-</div>
                </div>
            </div>

            <!-- P&L Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Cumulative P&L</div>
                    <div class="time-selector">
                        <div class="time-option">1D</div>
                        <div class="time-option">7D</div>
                        <div class="time-option active">30D</div>
                        <div class="time-option">90D</div>
                        <div class="time-option">1Y</div>
                        <div class="time-option">ALL</div>
                    </div>
                </div>
                <canvas id="pnlChart" style="width: 100%; height: 320px;"></canvas>
            </div>

            <!-- Quick Stats Grid -->
            <div class="two-column">
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Trading Statistics</div>
                    </div>
                    <table>
                        <tr>
                            <td style="color: var(--text-secondary)">Average Win</td>
                            <td class="mono" id="avgWin">-</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary)">Average Loss</td>
                            <td class="mono" id="avgLoss">-</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary)">Risk/Reward Ratio</td>
                            <td class="mono" id="riskRewardRatio">-</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary)">Trade Expectancy</td>
                            <td class="mono" id="expectancy">-</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary)">Recovery Factor</td>
                            <td class="mono" id="recoveryFactor">-</td>
                        </tr>
                    </table>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Time Analysis</div>
                    </div>
                    <table>
                        <tr>
                            <td style="color: var(--text-secondary)">Avg Hold Time (Win)</td>
                            <td class="mono" id="avgWinHoldTime">-</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary)">Avg Hold Time (Loss)</td>
                            <td class="mono" id="avgLossHoldTime">-</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary)">Best Trading Hour</td>
                            <td class="mono" id="bestHour">-</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary)">Worst Trading Hour</td>
                            <td class="mono" id="worstHour">-</td>
                        </tr>
                        <tr>
                            <td style="color: var(--text-secondary)">Most Active Day</td>
                            <td class="mono" id="mostActiveDay">-</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- Performance Tab -->
        <div class="tab-content" id="performance">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Calmar Ratio</div>
                    <div class="metric-value mono" id="calmarRatio">-</div>
                    <div class="metric-change mono">Annual return / Max DD</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Kelly Criterion</div>
                    <div class="metric-value mono" id="kellyCriterion">-</div>
                    <div class="metric-change mono">Optimal size</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Max Consec. Wins</div>
                    <div class="metric-value mono" id="maxConsecWins">-</div>
                    <div class="metric-change mono" id="maxConsecWinsValue">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Max Consec. Losses</div>
                    <div class="metric-value mono" id="maxConsecLosses">-</div>
                    <div class="metric-change mono" id="maxConsecLossesValue">-</div>
                </div>
            </div>
        </div>

        <!-- Risk Analysis Tab -->
        <div class="tab-content" id="risk">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Value at Risk (95%)</div>
                    <div class="metric-value mono" id="var95">-</div>
                    <div class="metric-change mono">Daily VaR</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Expected Shortfall</div>
                    <div class="metric-value mono" id="cvar95">-</div>
                    <div class="metric-change mono">CVaR 95%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Portfolio Volatility</div>
                    <div class="metric-value mono" id="volatility">-</div>
                    <div class="metric-change mono">Annualized</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Skewness</div>
                    <div class="metric-value mono" id="skewness">-</div>
                    <div class="metric-change mono">Distribution asymmetry</div>
                </div>
            </div>
        </div>

        <!-- Positions Tab -->
        <div class="tab-content" id="positions">
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">Current Positions</div>
                </div>
                <table id="positionsTable">
                    <thead>
                        <tr>
                            <th>MARKET</th>
                            <th>SIDE</th>
                            <th>SIZE</th>
                            <th>ENTRY</th>
                            <th>CURRENT</th>
                            <th>P&L</th>
                            <th>P&L %</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="7" style="text-align: center; color: var(--text-secondary);">
                                No data loaded
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Behavior Tab -->
        <div class="tab-content" id="behavior">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Pattern Detection</div>
                    <div class="metric-value mono">Coming Soon</div>
                    <div class="metric-change mono">Behavioral analysis</div>
                </div>
            </div>
        </div>

        <!-- Market Structure Tab -->
        <div class="tab-content" id="market">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Funding Captured</div>
                    <div class="metric-value mono" id="fundingCaptured">-</div>
                    <div class="metric-change mono">30-day total</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Funding Paid</div>
                    <div class="metric-value mono" id="fundingPaid">-</div>
                    <div class="metric-change mono">30-day total</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Net Funding</div>
                    <div class="metric-value mono" id="netFunding">-</div>
                    <div class="metric-change mono" id="netFundingPct">-</div>
                </div>
            </div>
        </div>

        <!-- Command Palette Hint -->
        <div class="cmd-hint">
            Press <span class="key">⌘</span><span class="key">K</span> for commands
        </div>
    </div>

    <!-- Load the application -->
    <script type="module" src="js/app.js"></script>
</body>
</html>